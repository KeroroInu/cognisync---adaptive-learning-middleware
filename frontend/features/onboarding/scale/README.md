# Scale Onboarding - é‡è¡¨æ³¨å†Œæµç¨‹

## ğŸ“‹ æ¦‚è¿°

é‡è¡¨æ³¨å†Œæµç¨‹æ˜¯ä¼ä¸šçº§å…¥èŒç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡æ ‡å‡†åŒ– Likert é‡è¡¨æ”¶é›†ç”¨æˆ·åŸºç¡€ç”»åƒï¼Œç”Ÿæˆåˆå§‹ä¸‰ç»´å­¦ä¹ æ¨¡å‹ï¼ˆè®¤çŸ¥ã€æƒ…æ„Ÿã€è¡Œä¸ºï¼‰ã€‚

---

## ğŸ—ï¸ ç›®å½•ç»“æ„

```
frontend/features/onboarding/scale/
â”œâ”€â”€ types.ts                        # ç±»å‹å®šä¹‰
â”œâ”€â”€ api.ts                          # API è°ƒç”¨
â”œâ”€â”€ ScaleOnboardingPage.tsx         # ä¸»é¡µé¢ç»„ä»¶
â””â”€â”€ components/
    â”œâ”€â”€ LikertItem.tsx              # Likert é¢˜ç›®ç»„ä»¶
    â”œâ”€â”€ ScaleProgress.tsx           # è¿›åº¦æ¡ç»„ä»¶
    â””â”€â”€ ScalePreview.tsx            # é‡è¡¨é¢„è§ˆç»„ä»¶
```

---

## ğŸ”„ å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç”¨æˆ·è¿›å…¥ /register/scale                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åŠ è½½æ¿€æ´»çš„é‡è¡¨æ¨¡æ¿                          â”‚
â”‚  GET /api/forms/active                                  â”‚
â”‚    â†“                                                    â”‚
â”‚  è¿”å›: ScaleTemplate (å« schema_json)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
   âœ… æˆåŠŸ                   âŒ å¤±è´¥
        â”‚                       â”‚
        â”‚                       â”œâ”€â†’ æ˜¾ç¤ºé”™è¯¯ + "è¿”å›"æŒ‰é’®
        â”‚                       â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åŠ¨æ€æ¸²æŸ“ Likert é¢˜ç›®                        â”‚
â”‚  - æŒ‰åˆ†é‡è¡¨åˆ†ç»„ï¼ˆå¦‚æœæœ‰ï¼‰                                â”‚
â”‚  - æ¯é¢˜ 1-5 å•é€‰                                        â”‚
â”‚  - å®æ—¶æ›´æ–°è¿›åº¦æ¡                                       â”‚
â”‚  - æ ‡è®°æœªç­”é¢˜                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ [ç‚¹å‡»"æäº¤é—®å·"]
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‰ç«¯éªŒè¯                                    â”‚
â”‚  - æ£€æŸ¥æ‰€æœ‰å¿…å¡«é¢˜æ˜¯å¦å·²ç­”                                â”‚
â”‚  - æœªç­”é¢˜ï¼šæ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ªæœªç­”é¢˜ + æ˜¾ç¤ºé”™è¯¯                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ âœ… éªŒè¯é€šè¿‡
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æäº¤ç­”æ¡ˆ                                    â”‚
â”‚  POST /api/forms/{templateId}/submit                    â”‚
â”‚  Body: { answers: { itemId: LikertValue } }            â”‚
â”‚    â†“                                                    â”‚
â”‚  è¿”å›: { scores, initialProfile, responseId }          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ›´æ–°å…¨å±€ç”»åƒ                                â”‚
â”‚  authStore.updateProfile(initialProfile)                â”‚
â”‚    â†“                                                    â”‚
â”‚  { cognition: 75, affect: 80, behavior: 70 }           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ˜¾ç¤ºå®Œæˆé¡µé¢                                â”‚
â”‚  - âœ… æ³¨å†Œå®Œæˆå›¾æ ‡                                      â”‚
â”‚  - ğŸ“Š é›·è¾¾å›¾å±•ç¤ºä¸‰ç»´ç”»åƒ                                â”‚
â”‚  - ğŸ“ˆ æ•°å­—æ˜¾ç¤ºï¼ˆè®¤çŸ¥/æƒ…æ„Ÿ/è¡Œä¸ºï¼‰                        â”‚
â”‚  - ğŸ’¡ æç¤ºä¿¡æ¯                                          â”‚
â”‚  - ğŸš€ "è¿›å…¥ç³»ç»Ÿ"æŒ‰é’®                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ [ç‚¹å‡»"è¿›å…¥ç³»ç»Ÿ"]
                    â–¼
              è·³è½¬åˆ° /chat æˆ– /
```

---

## ğŸ“ API æ¥å£è¯¦è§£

### 1. GET /api/forms/active

**åŠŸèƒ½ï¼š** è·å–å½“å‰æ¿€æ´»çš„é‡è¡¨æ¨¡æ¿

**è¯·æ±‚ï¼š**
```http
GET /api/forms/active
Authorization: Bearer {token}
```

**å“åº”ï¼š**
```json
{
  "id": "template-uuid-123",
  "name": "æ–°å‘˜å·¥å­¦ä¹ ç”»åƒé‡è¡¨ v1.0",
  "description": "é€šè¿‡æ ‡å‡†åŒ–é‡è¡¨å¿«é€Ÿå»ºç«‹åˆå§‹å­¦ä¹ ç”»åƒ",
  "version": "1.0.0",
  "is_active": true,
  "created_at": "2026-02-01T10:00:00Z",
  "updated_at": "2026-02-10T15:30:00Z",
  "schema_json": {
    "title": "å­¦ä¹ ç”»åƒè¯„ä¼°é—®å·",
    "description": "è¯·æ ¹æ®çœŸå®æ„Ÿå—ä½œç­”ï¼Œæ²¡æœ‰å¯¹é”™ä¹‹åˆ†",
    "items": [
      {
        "id": "item_1",
        "text": "æˆ‘èƒ½å¤Ÿå¿«é€Ÿç†è§£æ–°æ¦‚å¿µ",
        "subscale": "è®¤çŸ¥èƒ½åŠ›",
        "required": true,
        "reversed": false
      },
      {
        "id": "item_2",
        "text": "å­¦ä¹ æ–°çŸ¥è¯†è®©æˆ‘æ„Ÿåˆ°ç„¦è™‘",
        "subscale": "æƒ…æ„ŸçŠ¶æ€",
        "required": true,
        "reversed": true
      }
    ],
    "subscales": [
      {
        "id": "cognition",
        "name": "è®¤çŸ¥èƒ½åŠ›",
        "description": "è¯„ä¼°å­¦ä¹ è€…çš„è®¤çŸ¥æ°´å¹³",
        "itemIds": ["item_1", "item_3", "item_5"]
      },
      {
        "id": "affect",
        "name": "æƒ…æ„ŸçŠ¶æ€",
        "description": "è¯„ä¼°å­¦ä¹ è€…çš„æƒ…æ„Ÿå€¾å‘",
        "itemIds": ["item_2", "item_4", "item_6"]
      }
    ],
    "likertOptions": [
      { "value": 1, "label": "éå¸¸ä¸åŒæ„" },
      { "value": 2, "label": "ä¸åŒæ„" },
      { "value": 3, "label": "ä¸­ç«‹" },
      { "value": 4, "label": "åŒæ„" },
      { "value": 5, "label": "éå¸¸åŒæ„" }
    ]
  }
}
```

**é”™è¯¯ç ï¼š**
- `NO_ACTIVE_TEMPLATE` - å½“å‰æ²¡æœ‰æ¿€æ´»çš„é‡è¡¨

---

### 2. POST /api/forms/{templateId}/submit

**åŠŸèƒ½ï¼š** æäº¤ç”¨æˆ·ç­”æ¡ˆï¼Œç”Ÿæˆåˆå§‹ç”»åƒ

**è¯·æ±‚ï¼š**
```http
POST /api/forms/abc-123/submit
Authorization: Bearer {token}
Content-Type: application/json

{
  "answers": {
    "item_1": 4,
    "item_2": 2,
    "item_3": 5,
    "item_4": 3,
    "item_5": 4,
    "item_6": 2
  }
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "responseId": "response-uuid-456",
  "scores": [
    {
      "subscaleId": "cognition",
      "subscaleName": "è®¤çŸ¥èƒ½åŠ›",
      "score": 13,
      "maxScore": 15,
      "percentage": 86.7
    },
    {
      "subscaleId": "affect",
      "subscaleName": "æƒ…æ„ŸçŠ¶æ€",
      "score": 11,
      "maxScore": 15,
      "percentage": 73.3
    }
  ],
  "totalScore": 24,
  "maxScore": 30,
  "initialProfile": {
    "cognition": 75,
    "affect": 80,
    "behavior": 70
  }
}
```

**é”™è¯¯ç ï¼š**
- `INVALID_ANSWERS` - ç­”æ¡ˆæ ¼å¼ä¸æ­£ç¡®
- `TEMPLATE_NOT_FOUND` - é‡è¡¨æ¨¡æ¿ä¸å­˜åœ¨
- `MISSING_REQUIRED_ANSWERS` - ç¼ºå°‘å¿…å¡«ç­”æ¡ˆ

---

## ğŸ¨ ç»„ä»¶è¯¦è§£

### 1. ScaleOnboardingPage.tsx

**ä¸»é¡µé¢ç»„ä»¶ï¼Œåè°ƒæ•´ä¸ªæµç¨‹**

**Propsï¼š**
```typescript
interface ScaleOnboardingPageProps {
  language?: Language;           // è¯­è¨€ï¼ˆzh/enï¼‰
  onComplete: () => void;        // å®Œæˆåå›è°ƒï¼ˆè·³è½¬ /chatï¼‰
  onBack?: () => void;           // è¿”å›ä¸Šä¸€æ­¥ï¼ˆå¯é€‰ï¼‰
}
```

**çŠ¶æ€ç®¡ç†ï¼š**
```typescript
type OnboardingStatus = 'loading' | 'filling' | 'submitting' | 'completed' | 'error';

const [status, setStatus] = useState<OnboardingStatus>('loading');
const [template, setTemplate] = useState<ScaleTemplate | null>(null);
const [answers, setAnswers] = useState<ScaleAnswers>({});
const [errors, setErrors] = useState<ValidationError[]>([]);
const [initialProfile, setInitialProfile] = useState<InitialProfile | null>(null);
```

**æ ¸å¿ƒé€»è¾‘ï¼š**
1. **åŠ è½½æ¨¡æ¿ï¼š** `useEffect` è°ƒç”¨ `getActiveTemplate()`
2. **ç­”æ¡ˆæ”¶é›†ï¼š** `handleAnswerChange(itemId, value)` æ›´æ–° `answers`
3. **å‰ç«¯éªŒè¯ï¼š** `validateAnswers()` æ£€æŸ¥å¿…å¡«é¢˜
4. **æäº¤ï¼š** `handleSubmit()` è°ƒç”¨ API + æ›´æ–°å…¨å±€ profile
5. **å®Œæˆï¼š** æ˜¾ç¤ºé›·è¾¾å›¾ + "è¿›å…¥ç³»ç»Ÿ"æŒ‰é’®

---

### 2. LikertItem.tsx

**å•ä¸ª Likert é¢˜ç›®ç»„ä»¶**

**Propsï¼š**
```typescript
interface LikertItemProps {
  item: ScaleItem;              // é¢˜ç›®æ•°æ®
  index: number;                // åºå·ï¼ˆä» 1 å¼€å§‹ï¼‰
  options: LikertOption[];      // Likert é€‰é¡¹ï¼ˆ1-5ï¼‰
  value: LikertValue | null;    // å½“å‰é€‰æ‹©
  onChange: (itemId: string, value: LikertValue) => void;
  error?: string;               // é”™è¯¯æç¤º
  disabled?: boolean;           // æ˜¯å¦ç¦ç”¨
}
```

**UI ç‰¹æ€§ï¼š**
- âœ… é¢˜ç›®åºå· + æ–‡æœ¬ + å¿…å¡«æ ‡è®°ï¼ˆ*ï¼‰
- âœ… åˆ†é‡è¡¨æ ‡ç­¾ï¼ˆå¦‚æœæœ‰ï¼‰
- âœ… 1-5 å•é€‰æŒ‰é’®ï¼ˆæ¨ªå‘æ’åˆ—ï¼‰
- âœ… é€‰ä¸­çŠ¶æ€ï¼šè“è‰²è¾¹æ¡† + èƒŒæ™¯
- âœ… é”™è¯¯çŠ¶æ€ï¼šçº¢è‰²è¾¹æ¡† + é”™è¯¯æç¤º

---

### 3. ScaleProgress.tsx

**è¿›åº¦æ¡ç»„ä»¶**

**Propsï¼š**
```typescript
interface ScaleProgressProps {
  total: number;                // æ€»é¢˜æ•°
  answered: number;             // å·²ç­”é¢˜æ•°
  className?: string;
}
```

**UI ç‰¹æ€§ï¼š**
- âœ… æ˜¾ç¤º "å·²ç­”/æ€»æ•°"ï¼ˆå¦‚ "8 / 10"ï¼‰
- âœ… æ¸å˜è¿›åº¦æ¡ï¼ˆè“è‰² â†’ å®Œæˆåç»¿è‰²ï¼‰
- âœ… ç™¾åˆ†æ¯”æ˜¾ç¤ºï¼ˆå¦‚ "80% å®Œæˆ"ï¼‰
- âœ… å®Œæˆæ—¶æ˜¾ç¤º âœ… å›¾æ ‡

---

### 4. ScalePreview.tsx

**é‡è¡¨é¢„è§ˆç»„ä»¶ï¼ˆå¯é€‰ä½¿ç”¨ï¼‰**

**Propsï¼š**
```typescript
interface ScalePreviewProps {
  template: ScaleTemplate;
  onStart?: () => void;
  showStartButton?: boolean;
}
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- æ˜¾ç¤ºé‡è¡¨åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æè¿°ã€é¢˜æ•°ï¼‰
- å±•ç¤ºåˆ†é‡è¡¨ç»´åº¦
- æä¾›"å¼€å§‹å¡«å†™"æŒ‰é’®

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```tsx
import { ScaleOnboardingPage } from './features/onboarding/scale/ScaleOnboardingPage';

function ScaleRoute() {
  const navigate = useNavigate();

  const handleComplete = () => {
    // å®Œæˆåè·³è½¬åˆ°èŠå¤©é¡µé¢
    navigate('/chat');
  };

  const handleBack = () => {
    // è¿”å›åˆ°æ¨¡å¼é€‰æ‹©é¡µ
    navigate('/register');
  };

  return (
    <ScaleOnboardingPage
      language="zh"
      onComplete={handleComplete}
      onBack={handleBack}
    />
  );
}
```

### é…åˆè·¯ç”±å®ˆå«

```tsx
import { RequireAuth } from './routes/RequireAuth';

function ScaleRoute() {
  return (
    <RequireAuth onUnauthorized={() => navigate('/login')}>
      <ScaleOnboardingPage
        language="zh"
        onComplete={() => navigate('/chat')}
      />
    </RequireAuth>
  );
}
```

---

## ğŸ” æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯ç»„ä»¶                              â”‚
â”‚  ScaleOnboardingPage                                   â”‚
â”‚    â†“                                                   â”‚
â”‚  getActiveTemplate() â†’ è·å–æ¨¡æ¿                        â”‚
â”‚    â†“                                                   â”‚
â”‚  ç”¨æˆ·å¡«å†™ â†’ setAnswers({ item_1: 4, ... })            â”‚
â”‚    â†“                                                   â”‚
â”‚  validateAnswers() â†’ å‰ç«¯éªŒè¯                          â”‚
â”‚    â†“                                                   â”‚
â”‚  submitScaleAnswers(templateId, answers)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              features/onboarding/scale/api.ts          â”‚
â”‚  submitScaleAnswers(templateId, data) {                â”‚
â”‚    return apiClient.post(                             â”‚
â”‚      `/api/forms/${templateId}/submit`,               â”‚
â”‚      data                                             â”‚
â”‚    );                                                 â”‚
â”‚  }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               lib/apiClient.ts                         â”‚
â”‚  apiClient.post() {                                    â”‚
â”‚    headers['Authorization'] = `Bearer ${token}`;      â”‚
â”‚    fetch('/api/forms/xxx/submit', { ... })           â”‚
â”‚  }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               åç«¯ API                                  â”‚
â”‚  POST /api/forms/{templateId}/submit                   â”‚
â”‚  {                                                     â”‚
â”‚    "answers": { "item_1": 4, "item_2": 3 }           â”‚
â”‚  }                                                     â”‚
â”‚    â†“                                                   â”‚
â”‚  1. ä» token è¯†åˆ« userId                               â”‚
â”‚  2. éªŒè¯ç­”æ¡ˆæ ¼å¼                                       â”‚
â”‚  3. è®¡ç®—åˆ†é‡è¡¨å¾—åˆ†                                     â”‚
â”‚  4. ç”Ÿæˆåˆå§‹ç”»åƒï¼ˆcognition/affect/behaviorï¼‰          â”‚
â”‚  5. å­˜å‚¨æäº¤è®°å½•ï¼ˆuser_id, template_id, answersï¼‰      â”‚
â”‚  6. è¿”å› { scores, initialProfile, responseId }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯æ›´æ–°å…¨å±€çŠ¶æ€                              â”‚
â”‚  authStore.updateProfile(initialProfile)              â”‚
â”‚    â†“                                                   â”‚
â”‚  localStorage æ›´æ–° profile                             â”‚
â”‚  å…¨å±€ authState.profile = { cognition, affect, ... }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ˜¾ç¤ºå®Œæˆé¡µé¢                                  â”‚
â”‚  - é›·è¾¾å›¾å±•ç¤ºä¸‰ç»´ç”»åƒ                                  â”‚
â”‚  - "è¿›å…¥ç³»ç»Ÿ"æŒ‰é’® â†’ è·³è½¬ /chat                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”® æœªæ¥æ‰©å±•åŠŸèƒ½

### 1. åå°ç®¡ç† - é‡è¡¨ä¸Šä¼ 

**åŠŸèƒ½ï¼š** ç®¡ç†å‘˜å¯ä¸Šä¼ /ç¼–è¾‘é‡è¡¨æ¨¡æ¿

**å®ç°ï¼š**
```
åå°é¡µé¢ï¼š
/admin/forms/templates
  - åˆ—è¡¨ï¼šæ˜¾ç¤ºæ‰€æœ‰é‡è¡¨æ¨¡æ¿
  - æ–°å»ºï¼šä¸Šä¼  JSON æ–‡ä»¶æˆ–åœ¨çº¿ç¼–è¾‘
  - ç¼–è¾‘ï¼šä¿®æ”¹é¢˜ç›®ã€åˆ†é‡è¡¨ã€é€‰é¡¹
  - æ¿€æ´»/åœç”¨ï¼šè®¾ç½® is_active
```

**APIï¼š**
```http
POST /api/admin/forms/templates
Content-Type: application/json

{
  "name": "æ–°é‡è¡¨ v2.0",
  "description": "...",
  "schema_json": { ... }
}
```

**å‚è€ƒé—®å·æ˜Ÿï¼š**
- æ”¯æŒå¯¼å…¥é—®å·æ˜Ÿå¯¼å‡ºçš„ JSON
- åœ¨çº¿ç¼–è¾‘å™¨ï¼ˆæ‹–æ‹½é¢˜ç›®ã€è®¾ç½®åˆ†é‡è¡¨ï¼‰
- é¢„è§ˆåŠŸèƒ½

---

### 2. åå°ç®¡ç† - æŸ¥çœ‹ç”¨æˆ·ç­”é¢˜

**åŠŸèƒ½ï¼š** æŸ¥çœ‹ä¸åŒç”¨æˆ·çš„é‡è¡¨ç­”æ¡ˆï¼ˆå‰åæµ‹æ•°æ®ï¼‰

**å®ç°ï¼š**
```
åå°é¡µé¢ï¼š
/admin/forms/responses
  - ç­›é€‰ï¼šæŒ‰ç”¨æˆ·ã€æ—¶é—´ã€é‡è¡¨æ¨¡æ¿
  - åˆ—è¡¨ï¼šæ˜¾ç¤ºæäº¤è®°å½•
  - è¯¦æƒ…ï¼šæŸ¥çœ‹å•ä¸ªç”¨æˆ·çš„ç­”æ¡ˆ + å¾—åˆ†
  - å¯¹æ¯”ï¼šå‰æµ‹ vs åæµ‹ç”»åƒå˜åŒ–
```

**APIï¼š**
```http
GET /api/admin/forms/responses?user_id=xxx&template_id=yyy

Response:
{
  "responses": [
    {
      "id": "response-123",
      "user": { "id": "user-456", "name": "å¼ ä¸‰" },
      "template": { "id": "template-789", "name": "é‡è¡¨ v1.0" },
      "answers": { "item_1": 4, "item_2": 3 },
      "scores": [...],
      "initialProfile": { cognition: 75, ... },
      "submitted_at": "2026-02-10T10:00:00Z"
    }
  ]
}
```

---

### 3. æ•°æ®å¯¼å‡º

**åŠŸèƒ½ï¼š** å¯¼å‡ºé‡è¡¨æ•°æ®ç”¨äºåˆ†æ

**å®ç°ï¼š**
```
å¯¼å‡ºæ ¼å¼ï¼š
- CSVï¼šé€‚åˆ Excel åˆ†æ
- SPSS æ ¼å¼ï¼šé€‚åˆç»Ÿè®¡åˆ†æ
- JSONï¼šé€‚åˆç¨‹åºå¤„ç†
```

**APIï¼š**
```http
GET /api/admin/forms/export?template_id=xxx&format=csv

Response:
user_id,user_name,item_1,item_2,item_3,cognition,affect,behavior,submitted_at
user-123,å¼ ä¸‰,4,3,5,75,80,70,2026-02-10T10:00:00Z
user-456,æå››,5,4,4,85,75,80,2026-02-11T11:00:00Z
```

---

### 4. å‰åæµ‹å¯¹æ¯”

**åŠŸèƒ½ï¼š** å¯¹æ¯”ç”¨æˆ·å…¥èŒå‰åçš„ç”»åƒå˜åŒ–

**å®ç°ï¼š**
```
ç”¨æˆ·æäº¤ä¸¤æ¬¡ï¼š
1. å…¥èŒæ—¶ï¼ˆå‰æµ‹ï¼‰
2. åŸ¹è®­åï¼ˆåæµ‹ï¼‰

åå°å±•ç¤ºï¼š
- é›·è¾¾å›¾å åŠ ï¼ˆå‰æµ‹ vs åæµ‹ï¼‰
- æ•°æ®è¡¨æ ¼å¯¹æ¯”
- å¢é•¿è¶‹åŠ¿å›¾
```

**APIï¼š**
```http
GET /api/admin/users/xxx/progress

Response:
{
  "preTest": { cognition: 60, affect: 65, behavior: 70 },
  "postTest": { cognition: 75, affect: 80, behavior: 85 },
  "delta": { cognition: +15, affect: +15, behavior: +15 }
}
```

---

## ğŸš¨ é”™è¯¯å¤„ç†

### 1. æ²¡æœ‰æ¿€æ´»çš„é‡è¡¨

```tsx
// é”™è¯¯çŠ¶æ€æ˜¾ç¤º
<div className="glass-card p-8">
  <AlertCircle className="w-8 h-8 text-red-500" />
  <h2>å½“å‰æ²¡æœ‰æ¿€æ´»çš„é‡è¡¨æ¨¡æ¿</h2>
  <p>è¯·è”ç³»ç®¡ç†å‘˜æ¿€æ´»é‡è¡¨</p>
  <Button onClick={onBack}>è¿”å›</Button>
</div>
```

---

### 2. ç½‘ç»œé”™è¯¯

```tsx
catch (error: any) {
  if (error.code === 'NETWORK_ERROR') {
    setApiError('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
  }
}
```

---

### 3. éªŒè¯é”™è¯¯ï¼ˆæœªç­”å¿…å¡«é¢˜ï¼‰

```tsx
// æ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ªæœªç­”é¢˜
const element = document.getElementById(`item-${itemId}`);
element.scrollIntoView({ behavior: 'smooth', block: 'center' });

// æ˜¾ç¤ºçº¢è‰²è¾¹æ¡† + é”™è¯¯æç¤º
<LikertItem error="æ­¤é¢˜ä¸ºå¿…å¡«" />
```

---

## âœ… æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–

```tsx
// ä½¿ç”¨ useMemo ç¼“å­˜åˆ†ç»„ç»“æœ
const itemsBySubscale = useMemo(() => {
  // æŒ‰åˆ†é‡è¡¨åˆ†ç»„é€»è¾‘
}, [template]);
```

---

### 2. æ— éšœç¢è®¿é—®

```tsx
// ä½¿ç”¨è¯­ä¹‰åŒ– HTML
<label htmlFor={`item-${item.id}`}>
  <input
    id={`item-${item.id}`}
    type="radio"
    aria-label={item.text}
  />
</label>
```

---

### 3. å“åº”å¼è®¾è®¡

```tsx
// ç§»åŠ¨ç«¯ä¼˜åŒ–
<div className="grid grid-cols-1 md:grid-cols-3 gap-4">
  {/* åœ¨å°å±å¹•ä¸Šçºµå‘æ’åˆ—ï¼Œå¤§å±å¹•æ¨ªå‘ */}
</div>
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡ï¼ˆåç«¯å‚è€ƒï¼‰

### 1. scale_templates è¡¨

```sql
CREATE TABLE scale_templates (
  id UUID PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  schema_json JSONB NOT NULL,
  version VARCHAR(50),
  is_active BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

---

### 2. scale_responses è¡¨

```sql
CREATE TABLE scale_responses (
  id UUID PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES users(id),
  template_id UUID NOT NULL REFERENCES scale_templates(id),
  answers JSONB NOT NULL,
  scores JSONB NOT NULL,
  initial_profile JSONB NOT NULL,
  submitted_at TIMESTAMP DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX idx_responses_user ON scale_responses(user_id);
CREATE INDEX idx_responses_template ON scale_responses(template_id);
CREATE INDEX idx_responses_submitted ON scale_responses(submitted_at);
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒç‰¹æ€§

- âœ… åŠ¨æ€æ¸²æŸ“ Likert é‡è¡¨ï¼ˆ1-5 å•é€‰ï¼‰
- âœ… æ”¯æŒåˆ†é‡è¡¨åˆ†ç»„
- âœ… å®æ—¶è¿›åº¦è·Ÿè¸ª
- âœ… å‰ç«¯å¿…å¡«éªŒè¯ + æ»šåŠ¨åˆ°é”™è¯¯
- âœ… æäº¤åç”Ÿæˆä¸‰ç»´ç”»åƒ
- âœ… é›·è¾¾å›¾å¯è§†åŒ–
- âœ… æ›´æ–°å…¨å±€ authStore.profile
- âœ… å®Œæ•´é”™è¯¯å¤„ç†

### æœªæ¥æ‰©å±•

- ğŸ”® åå°é‡è¡¨ç®¡ç†ï¼ˆä¸Šä¼ /ç¼–è¾‘ï¼‰
- ğŸ”® æŸ¥çœ‹ç”¨æˆ·ç­”é¢˜è®°å½•
- ğŸ”® æ•°æ®å¯¼å‡ºï¼ˆCSV/SPSS/JSONï¼‰
- ğŸ”® å‰åæµ‹å¯¹æ¯”åˆ†æ

---

**æœ€åæ›´æ–°**: 2026-02-12
**ç‰ˆæœ¬**: 1.0.0
